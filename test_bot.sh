#!/bin/bash

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Lunch Bot"
echo "========================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º .env
if [ ! -f .env ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "–°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ: cp .env.example .env"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
if grep -q "–í–°–¢–ê–í–¨–¢–ï_–°–Æ–î–ê_–í–ê–®_–¢–û–ö–ï–ù" .env; then
    echo "‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ BOT_TOKEN –≤ —Ñ–∞–π–ª–µ .env!"
    echo "–û—Ç–∫—Ä–æ–π—Ç–µ: nano .env"
    exit 1
fi

if grep -q "–í–°–¢–ê–í–¨–¢–ï_–í–ê–®_ID" .env; then
    echo "‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ ADMIN_ID –≤ —Ñ–∞–π–ª–µ .env!"
    echo "–û—Ç–∫—Ä–æ–π—Ç–µ: nano .env"
    exit 1
fi

echo "‚úÖ –§–∞–π–ª .env –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
if [ ! -d "venv" ]; then
    echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
    python3 -m venv venv
fi

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º
source venv/bin/activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip install -r requirements.txt -q

echo ""
echo "‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É!"
echo ""
echo "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
echo "  1) –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (3 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ —Å –º–µ–Ω—é)"
echo "  2) –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞"
echo "  3) –í—Å—ë –≤–º–µ—Å—Ç–µ (–¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å)"
echo ""
read -p "–í–∞—à –≤—ã–±–æ—Ä (1/2/3): " choice

case $choice in
    1)
        echo ""
        echo "üçΩÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."
        python add_test_data.py
        ;;
    2)
        echo ""
        echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
        python main.py
        ;;
    3)
        echo ""
        echo "üçΩÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."
        python add_test_data.py
        echo ""
        echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
        python main.py
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        exit 1
        ;;
esac

